<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Inventory</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <script>
        function loadPresets(fieldId, category) {
            fetch(`/inventory/get-presets/?category=${category}`)
                .then(response => response.json())
                .then(data => {
                    let datalist = document.getElementById(fieldId + "_list");
                    datalist.innerHTML = "";
                    data.forEach(value => {
                        let option = document.createElement("option");
                        option.value = value;
                        datalist.appendChild(option);
                    });
                });
        }

        function calculateTotals() {
            let weight = parseFloat(document.getElementById("total_weight").value) || 0;
            let pricePerKg = parseFloat(document.getElementById("price_per_kg").value) || 0;
            let freight = parseFloat(document.getElementById("freight").value) || 0;
            let extraCharges = parseFloat(document.getElementById("extra_charges").value) || 0;
            let taxPercent = parseFloat(document.getElementById("tax_percent").value) || 0;

            let totalExTax = (weight * pricePerKg) + freight + extraCharges;
            let taxAmount = (totalExTax * taxPercent) / 100;
            let totalPrice = totalExTax + taxAmount;

            document.getElementById("total_price_ex_tax").value = totalExTax.toFixed(2);
            document.getElementById("tax_amount").value = taxAmount.toFixed(2);
            document.getElementById("total_price").value = totalPrice.toFixed(2);
        }

        function toggleFields() {
            let itemType = document.getElementById("itemType").value;

            document.getElementById("paperReelFields").style.display = (itemType === "Paper Reel") ? "block" : "none";
            document.getElementById("pastingGumFields").style.display = (itemType === "Pasting Gum") ? "block" : "none";
            document.getElementById("inkFields").style.display = (itemType === "Ink") ? "block" : "none";
            document.getElementById("strappingRollFields").style.display = (itemType === "Strapping Roll") ? "block" : "none";
            document.getElementById("pinCoilFields").style.display = (itemType === "Pin Coil") ? "block" : "none";
        }
    </script>
</head>

<body class="container mt-5">
    <h1>Add Inventory</h1>

    <form method="post">
        {% csrf_token %}

        <div class="mb-3">
            <label>Item Type</label>
            <select id="itemType" name="item_type" class="form-control" onchange="toggleFields()">
                <option value="">-- Select Item Type --</option>
                <option value="Paper Reel">Paper Reel</option>
                <option value="Pasting Gum">Pasting Gum</option>
                <option value="Ink">Ink</option>
                <option value="Strapping Roll">Strapping Roll</option>
                <option value="Pin Coil">Pin Coil</option>
            </select>
        </div>

        <div id="paperReelFields" style="display:none;">
    <label>GSM</label>
    <input type="text" id="gsm" name="gsm" class="form-control">

    <label>BF</label>
    <input type="text" id="bf" name="bf" class="form-control">  <!-- ✅ Added -->

    <label>Size</label>
    <input type="text" id="size" name="size" class="form-control">

    <label>Total Weight (Kg)</label>
    <input type="number" id="total_weight" name="total_weight" class="form-control">
</div>

        <!-- Pasting Gum Fields -->
        <div id="pastingGumFields" style="display:none;">
            <label>Gum Type</label>
            <input type="text" id="gum_type" name="gum_type" class="form-control">

            <label>Weight per Bag</label>
            <input type="number" id="weight_per_bag" name="weight_per_bag" class="form-control">  <!-- ✅ Added -->

            <label>Total Quantity</label>
            <input type="number" id="total_qty" name="total_qty" class="form-control">  <!-- ✅ Added -->
        </div>

        <!-- Ink Fields -->
        <div id="inkFields" style="display:none;">
            <label>Color</label>
            <input type="text" id="color" name="color" class="form-control">

            <label>Weight per Can</label>
            <input type="number" id="weight_per_can" name="weight_per_can" class="form-control">  <!-- ✅ Added -->

            <label>Total Quantity</label>
            <input type="number" id="total_qty" name="total_qty" class="form-control">  <!-- ✅ Added -->
        </div>

        <!-- Strapping Roll Fields -->
        <div id="strappingRollFields" style="display:none;">
            <label>Type</label>
            <input type="text" id="roll_type" name="roll_type" class="form-control" list="roll_type_list" onfocus="loadPresets('roll_type', 'roll_type')">
            <datalist id="roll_type_list"></datalist>

            <label>Total Quantity</label>
            <input type="number" id="total_qty_strap" name="total_qty" class="form-control" oninput="calculateTotals()">

            <label>Meters per Roll</label>
            <input type="number" id="meters_per_roll" name="meters_per_roll" class="form-control">

            <label>Weight per Roll</label>
            <input type="number" id="weight_per_roll" name="weight_per_roll" class="form-control">
        </div>
        <!-- Pin Coil Fields -->
        <div id="pinCoilFields" style="display:none;">
            <label>Type</label>
            <input type="text" id="coil_type" name="coil_type" class="form-control" list="coil_type_list" onfocus="loadPresets('coil_type', 'coil_type')">
            <datalist id="coil_type_list"></datalist>

            <label>Total Quantity</label>
            <input type="number" id="total_qty_coil" name="total_qty" class="form-control" oninput="calculateTotals()">
        </div>


        <!-- Common Fields -->
        <div class="mb-3">
            <label>Company Name</label>
            <input type="text" id="company_name" name="company_name" class="form-control" list="company_list" onfocus="loadPresets('company_name', 'company')">
            <datalist id="company_list"></datalist>
        </div>

        <div class="mb-3">
            <label>Price Per Kg</label>
            <input type="number" id="price_per_kg" name="price_per_kg" class="form-control" oninput="calculateTotals()">
        </div>

        <div class="mb-3">
            <label>Freight</label>
            <input type="number" id="freight" name="freight" class="form-control" oninput="calculateTotals()">
        </div>

        <div class="mb-3">
            <label>Extra Charges</label>
            <input type="number" id="extra_charges" name="extra_charges" class="form-control" oninput="calculateTotals()">
        </div>

        <div class="mb-3">
            <label>Tax %</label>
            <input type="number" id="tax_percent" name="tax_percent" class="form-control" oninput="calculateTotals()">
        </div>

        <h3>Auto-Calculated</h3>
        <div class="mb-3">
            <label>Total Price Excl. Tax</label>
            <input type="text" id="total_price_ex_tax" name="total_price_ex_tax" class="form-control" readonly>
        </div>

        <div class="mb-3">
            <label>Tax Amount</label>
            <input type="text" id="tax_amount" name="tax_amount" class="form-control" readonly>
        </div>

        <div class="mb-3">
            <label>Total Price</label>
            <input type="text" id="total_price" name="total_price" class="form-control" readonly>
        </div>

        <button type="submit" class="btn btn-primary w-100">Save Inventory</button>
    </form>

    <a href="{% url 'inventory_overview' %}" class="btn btn-secondary w-100 mt-3">Back to Inventory</a>
</body>
</html>
